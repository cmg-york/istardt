<?xml version="1.0" encoding="UTF-8"?>
<iStarDT  xmlns="https://example.org/istar-dt-x"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="https://example.org/istar-dt-x ../xsd/istar-rl-schema_v4.xsd">

    <header title="title"
            author="first last"
            source="path to xml file"
            lastUpdated="String date here">
        notes here
    </header>

    <options continuous="true" infeasible-action-penalty="1.0"></options>

    <!--  TODO all xml tag names with - should be avoided, need to adjust those -->
    <actors>
        <actor name="Manufacturer" description="A Manufacturer actor">
            <!--     [ [goals] ] [ [tasks] ] [ [qualities] ] [ [predicates] ]
        [ [condBoxes] ] [ [cross-set] ] [ [exported-set] ]  [ [initializations] ]   -->

            <crossSet>
                <crossRun><predicateID>identifer</predicateID></crossRun>
                <crossRun><variableID>identifer</variableID></crossRun>
                <crossRun><qualID>identifer</qualID></crossRun>
            </crossSet>

            <exportedSet>
                <export continuous="true" minVal="1.0" maxVal="2.0">
                    [exp-id]
                </export>
            </exportedSet>

        <initializations>
            <initialization element="[b-const-id]">true</initialization>
            <initialization element="[predicate-id]">true</initialization>

            <initialization element="[n-const-id]">1.0</initialization>
            <initialization element="[variable-id]">1.0</initialization>
            <initialization element="[qual-id]">1.0</initialization>
        </initializations>

            <predicates>
                <predicate description="Materials delivered on time (domestic)">deliveredInTimeDom</predicate>
                <predicate description="Materials delivered late (domestic)">deliveredLateDom</predicate>
                <predicate description="Materials never delivered (domestic)">neverDeliveredDom</predicate>
                <predicate description="Materials delivered on time (foreign)">deliveredInTimeFrgn</predicate>
                <predicate description="Materials delivered late (foreign)">deliveredLateFrgn</predicate>
                <predicate description="Materials never delivered (foreign)">neverDeliveredFrgn</predicate>
                <predicate description="In-house build with good quality">deliveredGoodQualityInH</predicate>
                <predicate description="In-house build with bad quality">deliveredBadQualityInH</predicate>
                <predicate description="Specialists produce good quality">deliveredGoodQualitySpec</predicate>
                <predicate description="Specialists produce bad quality">deliveredBadQualitySpec</predicate>
            </predicates>

        <!-- TODO complete variables section in XSD/XML -->
            <variables>
                <variable description="description">
                        hello
                </variable>
            </variables>

            <condBoxes>
                <condBox name="materialAvailable" description="Material availability in stock">
                    <!--  TODO double check [boolean-expression] -->
                    <formula>
                        <previous>
                            <predicateID>deliveredBadQualitySpec</predicateID>
                        </previous>
                    </formula>
                </condBox>

                <condBox name="hasManufacturingCapacity" description="Manufacturer has capacity to build in-house">
                    <formula>
                        <boolConst>false</boolConst>
                    </formula>
                </condBox>
            </condBoxes>

            <qualities>
                <quality name="Reputation" description="Reputation of the Manufacturer">
                    <negate>
                        <numConst>5</numConst>
                    </negate>
                </quality>

                <quality name="FinancialGain" description="Financial Gain">
                    <!--  TODO check [numeric-expression] -->
                    <!--   TODO no exported, has init decimal -->
                    <negate>
                        <add>
                            <numConst>2</numConst>
                            <numConst>5</numConst>
                            <numConst>10</numConst>
                        </add>
                    </negate>
                </quality>

                <quality name="TotalValue" root="true" description="Overall Value">
                    <add>
                        <qualID>Reputation</qualID>
                        <qualID>FinancialGain</qualID>
                    </add>
                </quality>
            </qualities>

            <goals>
                <goal name="ProductManufactured" terminal="false" root="true" description="Product Manufactured"
                      episodeLength="4">
                    <pre>
                        <predicateID>hasManufacturingCapacity</predicateID>
                    </pre>
                    <refinement type="AND">
                        <childGoal ref="MaterialOrdered"/>
                        <childGoal ref="ManufacturingCompleted"/>
                    </refinement>
                </goal>

                <goal name="MaterialOrdered" terminal="false"  description="Material Ordered">
                    <refinement type="OR">
                        <childTask ref="SourceDomestically"/>
                        <childTask ref="SourceFromAbroad"/>
                    </refinement>
                </goal>

                <goal name="ManufacturingCompleted" terminal="false"  description="Manufacturing Completed">
                    <pre>
                        <goalID>MaterialOrdered</goalID>
                    </pre>
                    <refinement type="OR">
                        <childTask ref="BuildInHouse"/>
                        <childTask ref="AssignToSpecialists"/>
                    </refinement>
                </goal>
            </goals>

            <tasks>
                <task name="SourceDomestically" description="Source materials from a domestic supplier">
                    <pre>
                        <predicateID>materialAvailable</predicateID>
                    </pre>
                    <effectGroup>
                        <effect name="successDeliveredInTimeDom" satisfying="true" probability="0.75"
                                description="Successful">
                            <turnsTrue>deliveredInTimeDom</turnsTrue>
                            <pre>
                                <taskID>SourceDomestically</taskID>
                            </pre>
                        </effect>
                        <effect name="successDeliveredLateDom" satisfying="true" probability="0.20"
                                description="Successful">
                            <turnsTrue>deliveredLateDom</turnsTrue>
                        </effect>
                        <effect name="failureDeliveredDom" satisfying="false" probability="0.05"
                                description="Failure">
                            <turnsTrue>neverDeliveredDom</turnsTrue>
                        </effect>
                    </effectGroup>
                </task>

                <task name="SourceFromAbroad" description="Source materials from a foreign supplier">
                    <effectGroup>
                        <effect name="successDeliveredInTimeFrgn" satisfying="true" probability="0.50"
                                description="Successful">
                            <turnsTrue>deliveredInTimeFrgn</turnsTrue>
                        </effect>
                        <effect name="successDeliveredLateFrgn" satisfying="true" probability="0.35"
                                description="Successful">
                            <turnsTrue>deliveredLateFrgn</turnsTrue>
                        </effect>
                        <effect name="failureDeliveredFrgn" satisfying="false" probability="0.15"
                                description="Failure">
                            <turnsTrue>neverDeliveredFrgn</turnsTrue>
                        </effect>
                    </effectGroup>
                </task>

                <task name="BuildInHouse" description="Build the product in-house">
                    <pre>
                        <predicateID>hasManufacturingCapacity</predicateID>
                    </pre>
                    <effectGroup>
                        <effect name="successInHGood" satisfying="true" probability="0.5"
                                description="Successful">
                            <turnsTrue>deliveredGoodQualityInH</turnsTrue>
                        </effect>
                        <effect name="successInHBad" satisfying="true" probability="0.5"
                                description="Successful">
                            <turnsTrue>deliveredBadQualityInH</turnsTrue>
                        </effect>
                    </effectGroup>
                </task>

                <task name="AssignToSpecialists" description="Assign product manufacturing to specialists">
                    <npr>
                        <taskID>SourceFromAbroad</taskID>
                    </npr>
                    <effectGroup>
                        <effect name="successSpecGood" satisfying="true" probability="0.7"
                                description="Successful">
                            <turnsTrue>deliveredGoodQualitySpec</turnsTrue>
                        </effect>
                        <effect name="successSpecBad" satisfying="true" probability="0.3"
                                description="Successful">
                            <turnsTrue>deliveredBadQualitySpec</turnsTrue>
                        </effect>
                    </effectGroup>
                </task>
            </tasks>
        </actor>

    </actors>
</iStarDT>